<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
	<title>光亮设置</title>
</head>

<body>
	<input type="range" id="lightLevelRange" min="0" max="1024" value="0" />
	<br />
	<label for="lightLevel" id="lightLevelLabel">光亮等级:00</label>
	<br />

	<button id="lightLevelLess">暗</button>
	<button id="lightLevelMore">亮</button>
	<button id="serverOff">关闭网络控制</button>
</body>

<script>
	let lightLevelRangeElement = document.getElementById("lightLevelRange");
	let lightLevelLabelElement = document.getElementById("lightLevelLabel");
	let lightLevelNextUpdateTime = 0;
	const lightLevelUpdateTime = 500;

	function sendLightLevel(lightLevel) {
		var request = new XMLHttpRequest();
		request.open("POST", "/api/setLightLevel");
		request.send(lightLevel.toString());
	}

	function lightLevelChangedForce() {
		lightLevelLabelElement.innerHTML = "光亮等级:" + lightLevelRangeElement.valueAsNumber;

		sendLightLevel(lightLevelRangeElement.valueAsNumber);
	}

	function lightLevelChanged() {
		lightLevelLabelElement.innerHTML = "光亮等级:" + lightLevelRangeElement.valueAsNumber;

		var date = new Date();
		if (date.getTime() > lightLevelNextUpdateTime) {
			lightLevelNextUpdateTime = date.getTime() + lightLevelUpdateTime;
			sendLightLevel(lightLevelRangeElement.valueAsNumber);
		}
	}

	function lightLevelAdd() {
		lightLevelRangeElement.valueAsNumber += 1;
		lightLevelChangedForce();
	}

	function lightLevelSub() {
		lightLevelRangeElement.valueAsNumber -= 1;
		lightLevelChangedForce();
	}

	function serverOff() {
		var request = new XMLHttpRequest();
		request.open("POST", "/api/serverOff");
		request.send("");
	}

	lightLevelRangeElement.addEventListener("input", lightLevelChanged);
	lightLevelRangeElement.addEventListener("change", lightLevelChangedForce);
	document.getElementById("lightLevelMore").addEventListener("click", lightLevelAdd);
	document.getElementById("lightLevelLess").addEventListener("click", lightLevelSub);
	document.getElementById("serverOff").addEventListener("click", serverOff);
	console.log("\"light.js\" loaded");
</script>

<style>
	a:link {
		text-decoration: none;
	}

	a:visited {
		text-decoration: none;
	}

	a:hover {
		text-decoration: underline;
	}

	a:active {
		text-decoration: underline;
	}

	body {
		background-color: #c2dadf;
	}
</style>

</html>